<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Welcome To… Scoresheet</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media (orientation: portrait) {
      .portrait\:hidden { display: none !important; }
    }
    @media (orientation: landscape) {
      .landscape\:hidden { display: none !important; }
    }
  </style>
  <style type="text/tailwindcss">
    @layer components {
      .house-input {
        @apply w-10 h-10 text-center text-sm font-bold
               border-2 border-gray-400 rounded bg-white
               focus:outline-none focus:ring-2 focus:ring-amber-400 focus:border-amber-400;
      }

      .fence-slot {
        @apply w-3 h-10 flex items-center justify-center cursor-pointer;
      }
      .fence-line {
        @apply block w-0.5 h-8 bg-gray-200 rounded-full transition-all;
      }
      .fence-slot:has(input:checked) .fence-line {
        @apply w-1 bg-amber-700;
      }
      .fence-slot:has(input:checked),
      .beauty-step:has(input:checked),
      .beauty-step:not(:has(input:checked)) ~ .beauty-step {
        @apply pointer-events-none;
      }

      /* Hide fence between two houses with the same number */
      div:has(> .house-input[value="1"]) + div:has(+ div > .house-input[value="1"]) .fence-slot,
      div:has(> .house-input[value="2"]) + div:has(+ div > .house-input[value="2"]) .fence-slot,
      div:has(> .house-input[value="3"]) + div:has(+ div > .house-input[value="3"]) .fence-slot,
      div:has(> .house-input[value="4"]) + div:has(+ div > .house-input[value="4"]) .fence-slot,
      div:has(> .house-input[value="5"]) + div:has(+ div > .house-input[value="5"]) .fence-slot,
      div:has(> .house-input[value="6"]) + div:has(+ div > .house-input[value="6"]) .fence-slot,
      div:has(> .house-input[value="7"]) + div:has(+ div > .house-input[value="7"]) .fence-slot,
      div:has(> .house-input[value="8"]) + div:has(+ div > .house-input[value="8"]) .fence-slot,
      div:has(> .house-input[value="9"]) + div:has(+ div > .house-input[value="9"]) .fence-slot,
      div:has(> .house-input[value="10"]) + div:has(+ div > .house-input[value="10"]) .fence-slot,
      div:has(> .house-input[value="11"]) + div:has(+ div > .house-input[value="11"]) .fence-slot,
      div:has(> .house-input[value="12"]) + div:has(+ div > .house-input[value="12"]) .fence-slot,
      div:has(> .house-input[value="13"]) + div:has(+ div > .house-input[value="13"]) .fence-slot,
      div:has(> .house-input[value="14"]) + div:has(+ div > .house-input[value="14"]) .fence-slot,
      div:has(> .house-input[value="15"]) + div:has(+ div > .house-input[value="15"]) .fence-slot {
        @apply invisible pointer-events-none;
      }

      div:has(> .pool-slot) {
        @apply relative;
      }
      .pool-slot {
        @apply absolute -bottom-1 -right-1 block pointer-events-none z-10;
      }
      .pool-shape {
        @apply block w-4 h-4 rounded-full
               border-2 border-gray-400
               bg-gray-200 transition-colors;
      }
      .pool-slot:has(input:checked) .pool-shape {
        @apply bg-sky-300 border-sky-400;
      }

      .beauty-step {
        @apply w-8 h-8 text-xs font-semibold
               border-2 border-emerald-300 rounded-full
               bg-white cursor-pointer
               flex items-center justify-center;
      }
      .beauty-step:has(input:checked) {
        @apply bg-emerald-500 text-white border-emerald-600;
      }

      .number-choice-btn {
        @apply focus:outline-none grid place-items-center;
      }

      #scoresheet:has(#tab-streets:checked) label[for="tab-streets"],
      #scoresheet:has(#tab-city-plans:checked) label[for="tab-city-plans"],
      #scoresheet:has(#tab-score:checked) label[for="tab-score"] {
        @apply text-teal-700 border-teal-600;
      }

      .objective-input {
        @apply w-10 h-10 text-center text-sm font-bold
               border-2 border-orange-400 rounded bg-white
               focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-400;
      }

      .contractor-step {
        @apply size-10 text-sm font-semibold
               border-2 border-amber-400 rounded
               bg-white cursor-pointer
               flex items-center justify-center;
      }
      .contractor-step:has(input:checked) {
        @apply bg-amber-500 text-white border-amber-600;
      }
      .contractor-step:has(input:checked),
      .contractor-step:not(:has(input:checked)) ~ .contractor-step {
        @apply pointer-events-none;
      }

      .estate-step {
        @apply w-8 h-8 text-xs font-semibold
               border-2 border-violet-300 rounded-full
               bg-white cursor-pointer
               flex items-center justify-center;
      }
      .estate-step:has(input:checked) {
        @apply bg-violet-500 text-white border-violet-600;
      }
      .estate-step:has(input:checked),
      .estate-step:not(:has(input:checked)) ~ .estate-step {
        @apply pointer-events-none;
      }

      .denial-step {
        @apply w-8 h-8 text-xs font-semibold
               border-2 border-red-300 rounded-full
               bg-white cursor-pointer
               flex items-center justify-center;
      }
      .denial-step:has(input:checked) {
        @apply bg-red-500 text-white border-red-600;
      }
      .denial-step:has(input:checked),
      .denial-step:not(:has(input:checked)) ~ .denial-step {
        @apply pointer-events-none;
      }

      #pool-gauge .gauge-val {
        @apply text-sky-300;
      }
      #pool-gauge .gauge-val.is-current {
        @apply text-sky-600;
      }
      #pool-gauge .gauge-val.is-current ~ .gauge-val {
        @apply text-gray-300;
      }

      #bis-gauge .gauge-val {
        @apply text-red-300;
      }
      #bis-gauge .gauge-val.is-current {
        @apply text-red-500;
      }
      #bis-gauge .gauge-val.is-current ~ .gauge-val {
        @apply text-gray-300;
      }
    }
  </style>
</head>
<body class="bg-teal-50 text-stone-800 h-dvh overflow-hidden">

  <!-- Portrait overlay -->
  <div id="portrait-overlay" class="fixed inset-0 z-50 bg-teal-50 flex flex-col items-center justify-center text-center px-8 landscape:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-phone-landscape text-teal-600 mb-6 animate-pulse" viewBox="0 0 16 16">
      <path d="M1 4.5a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1zm-1 6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2z"/>
      <path d="M14 7.5a1 1 0 1 0-2 0 1 1 0 0 0 2 0"/>
    </svg>
    <p class="text-lg font-semibold text-teal-800">Rotate your device</p>
    <p class="text-sm text-teal-600 mt-2">This scoresheet works best in landscape mode</p>
  </div>

  <div id="game-content" class="portrait:hidden h-dvh overflow-hidden">
    <form id="scoresheet" autocomplete="off" class="grid grid-cols-[auto_1fr] h-full">

      <!-- ========== LEFT SIDEBAR ========== -->
      <div class="flex flex-col items-center p-6">
        <button id="new-game-btn" type="button" class="text-red-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-play-btn" viewBox="0 0 16 16">
            <path d="M6.79 5.093A.5.5 0 0 0 6 5.5v5a.5.5 0 0 0 .79.407l3.5-2.5a.5.5 0 0 0 0-.814z"/>
            <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
          </svg>
        </button>

        <div class="w-full flex flex-col gap-6 grow justify-center">
          <label for="tab-streets" class="px-4 py-2 rounded-lg border-2 border-transparent text-gray-500 cursor-pointer transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-houses" viewBox="0 0 16 16">
              <path d="M5.793 1a1 1 0 0 1 1.414 0l.647.646a.5.5 0 1 1-.708.708L6.5 1.707 2 6.207V12.5a.5.5 0 0 0 .5.5.5.5 0 0 1 0 1A1.5 1.5 0 0 1 1 12.5V7.207l-.146.147a.5.5 0 0 1-.708-.708zm3 1a1 1 0 0 1 1.414 0L12 3.793V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v3.293l1.854 1.853a.5.5 0 0 1-.708.708L15 8.207V13.5a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 4 13.5V8.207l-.146.147a.5.5 0 1 1-.708-.708zm.707.707L5 7.207V13.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5V7.207z"/>
            </svg>
          </label>

          <label for="tab-city-plans" class="px-4 py-2 rounded-lg border-2 border-transparent text-gray-500 cursor-pointer transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-briefcase" viewBox="0 0 16 16">
              <path d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5m1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0M1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5"/>
            </svg>
          </label>

          <label for="tab-score" class="px-4 py-2 rounded-lg border-2 border-transparent text-gray-500 cursor-pointer transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" viewBox="0 0 16 16">
              <path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
              <path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
            </svg>
          </label>
        </div>

        <button id="undo-btn" type="button" class="text-red-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-backspace" viewBox="0 0 16 16">
            <path d="M5.83 5.146a.5.5 0 0 0 0 .708L7.975 8l-2.147 2.146a.5.5 0 0 0 .707.708l2.147-2.147 2.146 2.147a.5.5 0 0 0 .707-.708L9.39 8l2.146-2.146a.5.5 0 0 0-.707-.708L8.683 7.293 6.536 5.146a.5.5 0 0 0-.707 0z"/>
            <path d="M13.683 1a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-7.08a2 2 0 0 1-1.519-.698L.241 8.65a1 1 0 0 1 0-1.302L5.084 1.7A2 2 0 0 1 6.603 1zm-7.08 1a1 1 0 0 0-.76.35L1 8l4.844 5.65a1 1 0 0 0 .759.35h7.08a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z"/>
          </svg>
        </button>
      </div>

      <!-- Tab radios -->
      <input type="radio" name="tab" id="tab-streets" class="hidden peer/streets" checked>
      <input type="radio" name="tab" id="tab-city-plans" class="hidden peer/city-plans">
      <input type="radio" name="tab" id="tab-score" class="hidden peer/score" >

      <!-- ==================== TAB 1: Streets ==================== -->
      <div class="col-start-2 row-start-1 hidden peer-checked/streets:grid grid-cols-[1fr_5rem] h-full items-center">

        <!-- Streets content (left column) -->
        <div class="flex flex-col items-center justify-center space-y-6">

          <!-- ==================== Street 1 — 10 houses ==================== -->
          <section>
            <div class="flex items-start justify-center">

              <!-- House 1 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h1" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f1" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 2 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h2" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f2" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 3 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h3" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r1-p3" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f3" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 4 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h4" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f4" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 5 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h5" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f5" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 6 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h6" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f6" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 7 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h7" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r1-p7" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f7" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 8 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h8" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r1-p8" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f8" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 9 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h9" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r1-f9" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 10 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r1-h10" class="house-input"></button>
              </div>

            </div>
            <!-- Beauty / Parks gauge -->
            <div class="beauty-gauge flex items-center gap-2 mt-3 justify-center">
              <span class="text-sm font-medium text-emerald-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tree-fill" viewBox="0 0 16 16">
                  <path d="M8.416.223a.5.5 0 0 0-.832 0l-3 4.5A.5.5 0 0 0 5 5.5h.098L3.076 8.735A.5.5 0 0 0 3.5 9.5h.191l-1.638 3.276a.5.5 0 0 0 .447.724H7V16h2v-2.5h4.5a.5.5 0 0 0 .447-.724L12.31 9.5h.191a.5.5 0 0 0 .424-.765L10.902 5.5H11a.5.5 0 0 0 .416-.777z"/>
                </svg>
              </span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">0</span>
              <label class="beauty-step"><input type="checkbox" name="r1-b1" class="hidden">2</label>
              <label class="beauty-step"><input type="checkbox" name="r1-b2" class="hidden">4</label>
              <label class="beauty-step"><input type="checkbox" name="r1-b3" class="hidden">10</label>
            </div>
          </section>

          <!-- ==================== Street 2 — 11 houses ==================== -->
          <section>
            <div class="flex items-start justify-center">

              <!-- House 1 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h1" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r2-p1" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f1" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 2 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h2" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f2" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 3 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h3" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f3" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 4 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h4" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r2-p4" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f4" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 5 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h5" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f5" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 6 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h6" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f6" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 7 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h7" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f7" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 8 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h8" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r2-p8" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f8" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 9 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h9" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f9" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 10 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h10" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r2-f10" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 11 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r2-h11" class="house-input"></button>
              </div>

            </div>
            <!-- Beauty / Parks gauge -->
            <div class="beauty-gauge flex items-center gap-2 mt-3 justify-center">
              <span class="text-sm font-medium text-emerald-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tree-fill" viewBox="0 0 16 16">
                  <path d="M8.416.223a.5.5 0 0 0-.832 0l-3 4.5A.5.5 0 0 0 5 5.5h.098L3.076 8.735A.5.5 0 0 0 3.5 9.5h.191l-1.638 3.276a.5.5 0 0 0 .447.724H7V16h2v-2.5h4.5a.5.5 0 0 0 .447-.724L12.31 9.5h.191a.5.5 0 0 0 .424-.765L10.902 5.5H11a.5.5 0 0 0 .416-.777z"/>
                </svg>
              </span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">0</span>
              <label class="beauty-step"><input type="checkbox" name="r2-b1" class="hidden">2</label>
              <label class="beauty-step"><input type="checkbox" name="r2-b2" class="hidden">4</label>
              <label class="beauty-step"><input type="checkbox" name="r2-b3" class="hidden">6</label>
              <label class="beauty-step"><input type="checkbox" name="r2-b4" class="hidden">14</label>
            </div>
          </section>

          <!-- ==================== Street 3 — 12 houses ==================== -->
          <section>
            <div class="flex items-start justify-center">

              <!-- House 1 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h1" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f1" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 2 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h2" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r3-p2" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f2" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 3 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h3" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f3" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 4 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h4" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f4" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 5 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h5" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f5" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 6 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h6" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f6" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 7 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h7" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r3-p7" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f7" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 8 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h8" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f8" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 9 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h9" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f9" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 10 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h10" class="house-input"></button>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f10" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 11 (pool) -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h11" class="house-input"></button>
                <label class="pool-slot"><input type="checkbox" name="r3-p11" class="hidden"><span class="pool-shape"></span></label>
              </div>
              <div class="h-10 flex items-center"><label class="fence-slot"><input type="checkbox" name="r3-f11" class="hidden"><span class="fence-line"></span></label></div>

              <!-- House 12 -->
              <div class="flex flex-col items-center">
                <button type="button" name="r3-h12" class="house-input"></button>
              </div>

            </div>
            <!-- Beauty / Parks gauge -->
            <div class="beauty-gauge flex items-center gap-2 mt-3 justify-center">
              <span class="text-sm font-medium text-emerald-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tree-fill" viewBox="0 0 16 16">
                  <path d="M8.416.223a.5.5 0 0 0-.832 0l-3 4.5A.5.5 0 0 0 5 5.5h.098L3.076 8.735A.5.5 0 0 0 3.5 9.5h.191l-1.638 3.276a.5.5 0 0 0 .447.724H7V16h2v-2.5h4.5a.5.5 0 0 0 .447-.724L12.31 9.5h.191a.5.5 0 0 0 .424-.765L10.902 5.5H11a.5.5 0 0 0 .416-.777z"/>
                </svg>
              </span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">0</span>
              <label class="beauty-step"><input type="checkbox" name="r3-b1" class="hidden">2</label>
              <label class="beauty-step"><input type="checkbox" name="r3-b2" class="hidden">4</label>
              <label class="beauty-step"><input type="checkbox" name="r3-b3" class="hidden">6</label>
              <label class="beauty-step"><input type="checkbox" name="r3-b4" class="hidden">8</label>
              <label class="beauty-step"><input type="checkbox" name="r3-b5" class="hidden">18</label>
            </div>
          </section>

        </div><!-- /streets left column -->

        <!-- Pool & Bis gauges (right column) -->
        <div class="flex gap-4 items-start justify-center pr-4">
          <div class="flex flex-col items-center gap-1 font-semibold text-gray-300" id="pool-gauge">
            <span class="block size-4 rounded-full border-2 border-sky-400 bg-sky-200 mb-1"></span>
            <span class="gauge-val">0</span>
            <span class="gauge-val">3</span>
            <span class="gauge-val">6</span>
            <span class="gauge-val">9</span>
            <span class="gauge-val">13</span>
            <span class="gauge-val">17</span>
            <span class="gauge-val">21</span>
            <span class="gauge-val">26</span>
            <span class="gauge-val">31</span>
            <span class="gauge-val">36</span>
          </div>
          <div class="flex flex-col items-center font-semibold gap-1 text-gray-300" id="bis-gauge">
            <span class="text-red-400 mb-1 font-bold leading-none">bis</span>
            <span class="gauge-val">0</span>
            <span class="gauge-val">1</span>
            <span class="gauge-val">3</span>
            <span class="gauge-val">6</span>
            <span class="gauge-val">9</span>
            <span class="gauge-val">12</span>
            <span class="gauge-val">16</span>
            <span class="gauge-val">20</span>
            <span class="gauge-val">24</span>
            <span class="gauge-val">28</span>
          </div>
        </div>

      </div><!-- /tab streets -->

      <!-- ==================== TAB 2: City Plans ==================== -->
      <div class="col-start-2 row-start-1 hidden peer-checked/city-plans:grid grid-cols-[1fr_5rem] h-full items-center">

        <!-- City plans content (left column) -->
        <div class="flex gap-12 justify-center">

        <!-- Game Objectives -->
        <section class="flex flex-col items-center gap-2">
          <h3 class="text-sm font-semibold text-orange-700 text-center mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-file-earmark-richtext" viewBox="0 0 16 16">
              <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5z"/>
              <path d="M4.5 12.5A.5.5 0 0 1 5 12h3a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5m0-2A.5.5 0 0 1 5 10h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5m1.639-3.708 1.33.886 1.854-1.855a.25.25 0 0 1 .289-.047l1.888.974V8.5a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V8s1.54-1.274 1.639-1.208M6.25 6a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"/>
            </svg>
          </h3>
          <span class="text-[10px] text-gray-500">n°1</span>
          <button type="button" name="obj-1" class="objective-input"></button>
          <span class="text-[10px] text-gray-500">n°2</span>
          <button type="button" name="obj-2" class="objective-input"></button>
          <span class="text-[10px] text-gray-500">n°3</span>
          <button type="button" name="obj-3" class="objective-input"></button>
        </section>

        <!-- Contractors (Temp Agency) -->
        <section class="flex flex-col items-center gap-2">
          <h3 class="text-sm font-semibold text-amber-400 text-center mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-exclamation-diamond" viewBox="0 0 16 16">
              <path d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.48 1.48 0 0 1 0-2.098zm1.4.7a.495.495 0 0 0-.7 0L1.134 7.65a.495.495 0 0 0 0 .7l6.516 6.516a.495.495 0 0 0 .7 0l6.516-6.516a.495.495 0 0 0 0-.7L8.35 1.134z"/>
              <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
            </svg>
          </h3>
          <div class="flex items-center justify-center gap-1 flex-wrap max-w-24">
            <label class="contractor-step"><input type="checkbox" name="ctr-1" class="hidden">1</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-2" class="hidden">2</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-3" class="hidden">3</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-4" class="hidden">4</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-5" class="hidden">5</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-6" class="hidden">6</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-7" class="hidden">7</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-8" class="hidden">8</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-9" class="hidden">9</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-10" class="hidden">10</label>
            <label class="contractor-step"><input type="checkbox" name="ctr-11" class="hidden">11</label>
          </div>
        </section>

        <!-- Real Estate — fenced-area upgrade gauges -->
        <section class="flex flex-col items-center gap-2">
          <h3 class="text-sm font-semibold text-violet-700 text-center mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-graph-up-arrow" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M0 0h1v15h15v1H0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5"/>
            </svg>
          </h3>
          <div class="flex items-start gap-2">

            <!-- Size 1 -->
            <div class="flex flex-col items-center justify-center gap-2">
              <span class="text-xs font-medium text-violet-600">1</span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">1</span>
              <label class="estate-step"><input type="checkbox" name="est1-1" class="hidden">3</label>
            </div>

            <!-- Size 2 -->
            <div class="flex flex-col items-center justify-center gap-2">
              <span class="text-xs font-medium text-violet-600">2</span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">2</span>
              <label class="estate-step"><input type="checkbox" name="est2-1" class="hidden">3</label>
              <label class="estate-step"><input type="checkbox" name="est2-2" class="hidden">4</label>
            </div>

            <!-- Size 3 -->
            <div class="flex flex-col items-center justify-center gap-2">
              <span class="text-xs font-medium text-violet-600">3</span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">3</span>
              <label class="estate-step"><input type="checkbox" name="est3-1" class="hidden">4</label>
              <label class="estate-step"><input type="checkbox" name="est3-2" class="hidden">5</label>
              <label class="estate-step"><input type="checkbox" name="est3-3" class="hidden">6</label>
            </div>

            <!-- Size 4 -->
            <div class="flex flex-col items-center justify-center gap-2">
              <span class="text-xs font-medium text-violet-600">4</span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">4</span>
              <label class="estate-step"><input type="checkbox" name="est4-1" class="hidden">5</label>
              <label class="estate-step"><input type="checkbox" name="est4-2" class="hidden">6</label>
              <label class="estate-step"><input type="checkbox" name="est4-3" class="hidden">7</label>
              <label class="estate-step"><input type="checkbox" name="est4-4" class="hidden">8</label>
            </div>

            <!-- Size 5 -->
            <div class="flex flex-col items-center justify-center gap-2">
              <span class="text-xs font-medium text-violet-600">5</span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">5</span>
              <label class="estate-step"><input type="checkbox" name="est5-1" class="hidden">6</label>
              <label class="estate-step"><input type="checkbox" name="est5-2" class="hidden">7</label>
              <label class="estate-step"><input type="checkbox" name="est5-3" class="hidden">8</label>
              <label class="estate-step"><input type="checkbox" name="est5-4" class="hidden">10</label>
            </div>

            <!-- Size 6 -->
            <div class="flex flex-col items-center justify-center gap-2">
              <span class="text-xs font-medium text-violet-600">6</span>
              <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">6</span>
              <label class="estate-step"><input type="checkbox" name="est6-1" class="hidden">7</label>
              <label class="estate-step"><input type="checkbox" name="est6-2" class="hidden">8</label>
              <label class="estate-step"><input type="checkbox" name="est6-3" class="hidden">10</label>
              <label class="estate-step"><input type="checkbox" name="est6-4" class="hidden">12</label>
            </div>

          </div>
        </section>

        <!-- Denials -->
        <section class="flex flex-col items-center gap-2">
          <h3 class="text-sm font-semibold text-red-700 text-center mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-sign-stop" viewBox="0 0 16 16">
              <path d="M3.16 10.08c-.931 0-1.447-.493-1.494-1.132h.653c.065.346.396.583.891.583.524 0 .83-.246.83-.62 0-.303-.203-.467-.637-.572l-.656-.164c-.61-.147-.978-.51-.978-1.078 0-.706.597-1.184 1.444-1.184.853 0 1.386.475 1.436 1.087h-.645c-.064-.32-.352-.542-.797-.542-.472 0-.77.246-.77.6 0 .261.196.437.553.522l.654.161c.673.164 1.06.487 1.06 1.11 0 .736-.574 1.228-1.544 1.228Zm3.427-3.51V10h-.665V6.57H4.753V6h3.006v.568H6.587Z"/>
              <path fill-rule="evenodd" d="M11.045 7.73v.544c0 1.131-.636 1.805-1.661 1.805-1.026 0-1.664-.674-1.664-1.805V7.73c0-1.136.638-1.807 1.664-1.807s1.66.674 1.66 1.807Zm-.674.547v-.553c0-.827-.422-1.234-.987-1.234-.572 0-.99.407-.99 1.234v.553c0 .83.418 1.237.99 1.237.565 0 .987-.408.987-1.237m1.15-2.276h1.535c.82 0 1.316.55 1.316 1.292 0 .747-.501 1.289-1.321 1.289h-.865V10h-.665zm1.436 2.036c.463 0 .735-.272.735-.744s-.272-.741-.735-.741h-.774v1.485z"/>
              <path fill-rule="evenodd" d="M4.893 0a.5.5 0 0 0-.353.146L.146 4.54A.5.5 0 0 0 0 4.893v6.214a.5.5 0 0 0 .146.353l4.394 4.394a.5.5 0 0 0 .353.146h6.214a.5.5 0 0 0 .353-.146l4.394-4.394a.5.5 0 0 0 .146-.353V4.893a.5.5 0 0 0-.146-.353L11.46.146A.5.5 0 0 0 11.107 0zM1 5.1 5.1 1h5.8L15 5.1v5.8L10.9 15H5.1L1 10.9z"/>
            </svg>
          </h3>
          <span class="w-8 h-8 text-xs font-semibold border-2 border-gray-300 rounded-full bg-gray-100 flex items-center justify-center text-gray-400">0</span>
          <label class="denial-step"><input type="checkbox" name="den-1" class="hidden">0</label>
          <label class="denial-step"><input type="checkbox" name="den-2" class="hidden">3</label>
          <label class="denial-step"><input type="checkbox" name="den-3" class="hidden">5</label>
        </section>

        </div><!-- /city plans left column -->

        <!-- Empty right column (preserves layout consistency) -->
        <div></div>

      </div><!-- /tab city-plans -->

      <!-- ==================== TAB 3: Score Summary ==================== -->
      <div class="col-start-2 row-start-1 hidden peer-checked/score:grid grid-cols-[1fr_5rem] h-full items-center">

        <!-- Score content (left column) -->
        <div class="grid place-items-center h-full">
          <div class="inline-grid grid-cols-2 grid-flow-dense items-center gap-10">
            <!-- Left column: objectives, parks, pools, bis, denials -->
            <table class="text-sm">
              <tr>
                <td class="pr-4 py-0.5 text-gray-600">Plan n°1</td>
                <td class="text-right font-bold tabular-nums w-10" id="score-obj1">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-gray-600">Plan n°2</td>
                <td class="text-right font-bold tabular-nums w-10" id="score-obj2">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-gray-600">Plan n°3</td>
                <td class="text-right font-bold tabular-nums w-10" id="score-obj3">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-emerald-700">Parks</td>
                <td class="text-right font-bold tabular-nums w-10 text-emerald-700" id="score-parks">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-sky-600">Pools (<span id="score-pool-count">0</span>)</td>
                <td class="text-right font-bold tabular-nums w-10 text-sky-600" id="score-pools">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-red-600">Bis (<span id="score-bis-count">0</span>)</td>
                <td class="text-right font-bold tabular-nums w-10 text-red-600" id="score-bis">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-red-600">Prohibitions</td>
                <td class="text-right font-bold tabular-nums w-10 text-red-600" id="score-denials">0</td>
              </tr>
            </table>

            <!-- Middle column: zones -->
            <table class="text-sm">
              <tr>
                <td class="pr-4 py-0.5 text-violet-600">Size 1 (<span id="score-zone1-count">0</span>)</td>
                <td class="text-right font-bold tabular-nums w-10 text-violet-600" id="score-zone1">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-violet-600">Size 2 (<span id="score-zone2-count">0</span>)</td>
                <td class="text-right font-bold tabular-nums w-10 text-violet-600" id="score-zone2">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-violet-600">Size 3 (<span id="score-zone3-count">0</span>)</td>
                <td class="text-right font-bold tabular-nums w-10 text-violet-600" id="score-zone3">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-violet-600">Size 4 (<span id="score-zone4-count">0</span>)</td>
                <td class="text-right font-bold tabular-nums w-10 text-violet-600" id="score-zone4">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-violet-600">Size 5 (<span id="score-zone5-count">0</span>)</td>
                <td class="text-right font-bold tabular-nums w-10 text-violet-600" id="score-zone5">0</td>
              </tr>
              <tr>
                <td class="pr-4 py-0.5 text-violet-600">Size 6 (<span id="score-zone6-count">0</span>)</td>
                <td class="text-right font-bold tabular-nums w-10 text-violet-600" id="score-zone6">0</td>
              </tr>
            </table>

            <!-- Bottom row: contractors -->
            <div class="flex items-center gap-3 text-sm text-amber-700 col-span-2">
              <span class="font-medium">Contractors (<span id="score-ctr-count">0</span>)</span>
              <div class="flex gap-2">
                <label class="inline-block cursor-pointer"><input type="radio" name="ctr-score" value="7" class="hidden peer"><span class="inline-flex items-center justify-center w-10 h-10 text-sm font-bold rounded-lg border-2 border-gray-300 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600">7</span></label>
                <label class="inline-block cursor-pointer"><input type="radio" name="ctr-score" value="4" class="hidden peer"><span class="inline-flex items-center justify-center w-10 h-10 text-sm font-bold rounded-lg border-2 border-gray-300 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600">4</span></label>
                <label class="inline-block cursor-pointer"><input type="radio" name="ctr-score" value="1" class="hidden peer"><span class="inline-flex items-center justify-center w-10 h-10 text-sm font-bold rounded-lg border-2 border-gray-300 peer-checked:bg-amber-500 peer-checked:text-white peer-checked:border-amber-600">1</span></label>
                <label class="inline-block cursor-pointer"><input type="radio" name="ctr-score" value="0" class="hidden peer"><span class="inline-flex items-center justify-center w-10 h-10 text-sm font-bold rounded-lg border-2 border-gray-300 peer-checked:bg-gray-500 peer-checked:text-white peer-checked:border-gray-600">0</span></label>
              </div>
            </div>

          </div>
        </div><!-- /score left column -->

        <!-- Total (right column) -->
        <div class="flex flex-col items-center justify-center h-full">
          <span class="text-xs text-gray-500 uppercase tracking-wide">Total</span>
          <span class="text-4xl font-bold tabular-nums" id="score-total">0</span>
        </div>

      </div><!-- /tab score -->

    </form>
  </div><!-- /game-content -->

  <dialog id="number-choice" closedby="none" class="rounded-lg">
    <form class="grid grid-cols-8 gap-2 p-3" method="dialog">
      <button class="border rounded-full size-20">X</button>
      <button class="number-choice-btn border rounded-full size-20" value="1">1</button>
      <button class="number-choice-btn border rounded-full size-20" value="2">2</button>
      <button class="number-choice-btn border rounded-full size-20" value="3">3</button>
      <button class="number-choice-btn border rounded-full size-20" value="4">4</button>
      <button class="number-choice-btn border rounded-full size-20" value="5">5</button>
      <button class="number-choice-btn border rounded-full size-20" value="6">6</button>
      <button class="number-choice-btn border rounded-full size-20" value="7">7</button>
      <button class="number-choice-btn border rounded-full size-20" value="8">8</button>
      <button class="number-choice-btn border rounded-full size-20" value="9">9</button>
      <button class="number-choice-btn border rounded-full size-20" value="10">10</button>
      <button class="number-choice-btn border rounded-full size-20" value="11">11</button>
      <button class="number-choice-btn border rounded-full size-20" value="12">12</button>
      <button class="number-choice-btn border rounded-full size-20" value="13">13</button>
      <button class="number-choice-btn border rounded-full size-20" value="14">14</button>
      <button class="number-choice-btn border rounded-full size-20" value="15">15</button>
    </form>
  </dialog>

  <dialog id="pool-choice" closedby="none" class="rounded-lg">
    <form class="grid grid-cols-2 gap-6 p-6 rounded-lg" method="dialog">
      <button class="grid place-items-center border-2 size-24 border-sky-400 bg-sky-300 rounded-full text-lg" value="yes"></button>
      <button class="grid place-items-center border-2 size-24 border-gray-400 bg-gray-200 rounded-full text-lg" value="no"></button>
    </form>
  </dialog>

  <script>
    function getMoves() {
      try {
        var parsed = JSON.parse(localStorage.getItem('scoresheet'));
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) { return []; }
    }

    function saveMoves(moves) {
      localStorage.setItem('scoresheet', JSON.stringify(moves));
      updateGauges();
    }

    function replayMoves(moves) {
      for (const elt of document.querySelectorAll('#scoresheet [name]')) {
        if (elt.type === 'checkbox') elt.checked = false;
        else if (elt.type === 'radio' && elt.name !== "tab") elt.checked = false;
        else { elt.textContent = ''; elt.removeAttribute('value'); }
      };

      for (const move of moves) {
        var elt = document.querySelector(`[name="${move.key}"]`);
        if (!elt) continue;
        if (elt.type === 'checkbox') elt.checked = true;
        else { elt.textContent = move.bis ? 'bis' : move.value; elt.setAttribute('value', move.value); }
      }

      updateGauges();
    }

    function updateGauges() {
      const poolCount = Math.min(9, document.querySelectorAll('.pool-slot input:checked').length);
      const bisCount = Math.min(9, Array.from(document.querySelectorAll('button.house-input')).filter(b => b.textContent === 'bis').length);

      for (const [idx, el] of document.querySelectorAll('#pool-gauge .gauge-val').entries()) { el.classList.toggle('is-current', idx === poolCount) };
      for (const [idx, el] of document.querySelectorAll('#bis-gauge .gauge-val').entries()) { el.classList.toggle('is-current', idx === bisCount) };

      updateScoreSummary();
    }

    function updateScoreSummary() {
      // Objectives
      let obj1 = parseInt(document.querySelector('[name="obj-1"]').getAttribute('value')) || 0;
      let obj2 = parseInt(document.querySelector('[name="obj-2"]').getAttribute('value')) || 0;
      let obj3 = parseInt(document.querySelector('[name="obj-3"]').getAttribute('value')) || 0;

      // Parks — last checked beauty step per row
      let parksTotal = 
        Math.max(0, ...Array.from(document.querySelectorAll(`[name^="r1-h"]:checked`)).map(h => parseInt(h.getAttribute('value')))) +
        Math.max(0, ...Array.from(document.querySelectorAll(`[name^="r2-h"]:checked`)).map(h => parseInt(h.getAttribute('value')))) +
        Math.max(0, ...Array.from(document.querySelectorAll(`[name^="r3-h"]:checked`)).map(h => parseInt(h.getAttribute('value'))));

      // Pools
      let poolValues = [0, 3, 6, 9, 13, 17, 21, 26, 31, 36];
      let poolCount = Math.min(9, document.querySelectorAll('.pool-slot input:checked').length);
      let poolScore = poolValues[poolCount];

      // Bis
      let bisValues = [0, 1, 3, 6, 9, 12, 16, 20, 24, 28];
      let bisCount = Math.min(9, Array.from(document.querySelectorAll('button.house-input')).filter(b => b.textContent === 'bis').length);
      let bisScore = bisValues[bisCount];

      // Denials — last checked denial step
      let denialScore = Math.max(0, ...Array.from(document.querySelectorAll('[name^="den-"]:checked')).map(cb => parseInt(cb.parentElement.textContent)));

      // Contractors — count checked, score from radio
      let ctrCount = document.querySelectorAll('[name^="ctr-"]:not([name="ctr-score"]):checked').length;
      let ctrScoreRadio = document.querySelector('[name="ctr-score"]:checked');
      let ctrScore = ctrScoreRadio ? parseInt(ctrScoreRadio.value) : 0;

      // Zones — count completed estates per size across all streets
      let zoneCounts = {1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0};
      let streets = [{prefix: 'r1', houses: 10}, {prefix: 'r2', houses: 11}, {prefix: 'r3', houses: 12}];
      streets.forEach(function(street) {
        // Collect fence positions (fence i sits between house i and house i+1)
        const fences = Array.from(document.querySelectorAll(`[name^=${street.prefix}-f]`)).map((elt, idx) => elt.checked ? idx + 1 : null).filter(Boolean);
        // Boundaries: start-of-street, each fence, end-of-street
        const bounds = [0, ...fences, street.houses];

        for (const [l, r] of pairs(bounds)) {
          const size = r - l;
          if (size < 1 || size > 6) continue;
          // Check every house in this segment is built
          const allBuilt = Array.from(document.querySelectorAll(`[name^="${street.prefix}-h"]`))
            .slice(l, r)
            .every((h) => h.getAttribute('value'));
          if (allBuilt) zoneCounts[size]++;
        }
      });

      // Estate value per size: base value unless upgraded
      let baseValues = {1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6};
      let zoneTotal = 0;
      for (let s = 1; s <= 6; s++) {
        let estValue = baseValues[s];
        document.querySelectorAll(`[name^="est${s}-"]`).forEach(function(cb) {
          if (cb.checked) estValue = parseInt(cb.parentElement.textContent);
        });
        let zoneScore = zoneCounts[s] * estValue;
        zoneTotal += zoneScore;
        document.getElementById(`score-zone${s}`).textContent = zoneScore;
        document.getElementById(`score-zone${s}-count`).textContent = zoneCounts[s];
      }

      // Update DOM
      document.getElementById('score-obj1').textContent = obj1;
      document.getElementById('score-obj2').textContent = obj2;
      document.getElementById('score-obj3').textContent = obj3;
      document.getElementById('score-parks').textContent = parksTotal;
      document.getElementById('score-pool-count').textContent = poolCount;
      document.getElementById('score-pools').textContent = poolScore;
      document.getElementById('score-bis-count').textContent = bisCount;
      document.getElementById('score-bis').textContent = bisScore ? '-' + bisScore : '0';
      document.getElementById('score-denials').textContent = denialScore ? '-' + denialScore : '0';
      document.getElementById('score-ctr-count').textContent = ctrCount;

      let total = obj1 + obj2 + obj3 + parksTotal + poolScore + ctrScore + zoneTotal - bisScore - denialScore;
      document.getElementById('score-total').textContent = total;
    }

    // Form: record checkbox moves
    document.getElementById('scoresheet').addEventListener('change', function (e) {
      let t = e.target;
      let key = t.getAttribute('name');
      if (!key || t.type !== 'checkbox') return;
      let moves = getMoves();
      moves.push({ key: key, value: true });
      saveMoves(moves);
    });

    // Undo
    document.getElementById('undo-btn').addEventListener('click', function () {
      let moves = getMoves();
      if (!moves.length) return;
      moves.pop();
      saveMoves(moves);
      replayMoves(moves);
    });

    // Contractor score radio
    document.querySelectorAll('[name="ctr-score"]').forEach(function(radio) {
      radio.addEventListener('change', function() {
        localStorage.setItem('ctr-score', radio.value);
        updateScoreSummary();
      });
    });

    // New Game
    document.getElementById('new-game-btn').addEventListener('click', function () {
      if (!confirm('Start a new game? This will clear all progress.')) return;
      localStorage.removeItem('scoresheet');
      localStorage.removeItem('ctr-score');
      location.reload();
    });

    for (let btn of document.querySelectorAll('button.house-input')) {
      btn.addEventListener('click', function () {
        if (btn.textContent) return; // Don't open dialog if already has a value
        var dialog = document.getElementById('number-choice');

        dialog.returnValue = '';
        let otherBtns = Array.from(btn.closest('section').querySelectorAll('button.house-input'));
        let indexOfMe = otherBtns.indexOf(btn);
        let previousValues = otherBtns.slice(0, indexOfMe).map(b => b.value).filter(Boolean);
        let nextValues = otherBtns.slice(indexOfMe + 1).map(b => b.value).filter(Boolean);
        let minValue = Math.max(0, ...previousValues), maxValue = Math.min(16, ...nextValues);
        let rowPrefix = btn.getAttribute('name').split('-')[0];
        let prevBis = indexOfMe > 0 && otherBtns[indexOfMe - 1].value && !document.querySelector(`[name="${rowPrefix}-f${indexOfMe}"]`)?.checked ? Number(otherBtns[indexOfMe - 1].value) : null;
        let nextBis = indexOfMe < otherBtns.length - 1 && otherBtns[indexOfMe + 1].value && !document.querySelector(`[name="${rowPrefix}-f${indexOfMe + 1}"]`)?.checked ? Number(otherBtns[indexOfMe + 1].value) : null;

        for (let numberBtn of dialog.querySelectorAll('.number-choice-btn')) {
          let n = Number(numberBtn.value);
          numberBtn.textContent = numberBtn.value;
          if (n === prevBis || n === nextBis) {
            numberBtn.textContent = numberBtn.value + ' bis';
            numberBtn.classList.remove('opacity-10', 'cursor-not-allowed', 'pointer-events-none');
          } else if (n <= minValue || n >= maxValue) {
            numberBtn.classList.add('opacity-10', 'cursor-not-allowed', 'pointer-events-none');
          } else {
            numberBtn.classList.remove('opacity-10', 'cursor-not-allowed', 'pointer-events-none');
          }
        }

        var onClose = function () {
          dialog.removeEventListener('close', onClose);
          if (dialog.returnValue) {
            let n = Number(dialog.returnValue);
            let isBis = (prevBis !== null && n === prevBis) || (nextBis !== null && n === nextBis);
            btn.textContent = isBis ? 'bis' : dialog.returnValue;
            btn.setAttribute('value', dialog.returnValue);
            var moves = getMoves();
            moves.push({ key: btn.getAttribute('name'), value: dialog.returnValue, bis: isBis });
            saveMoves(moves);

            // If this house has a pool, ask about it
            let poolInput = btn.parentElement.querySelector('.pool-slot input');
            if (poolInput && !poolInput.checked) {
              let poolDialog = document.getElementById('pool-choice');
              poolDialog.returnValue = '';
              var onPoolClose = function () {
                poolDialog.removeEventListener('close', onPoolClose);
                if (poolDialog.returnValue === 'yes') {
                  poolInput.checked = true;
                  var moves = getMoves();
                  moves.push({ key: poolInput.getAttribute('name'), value: true });
                  saveMoves(moves);
                }
              };
              poolDialog.addEventListener('close', onPoolClose);
              poolDialog.showModal();
            }
          }
          dialog.returnValue = '';
        };
        dialog.addEventListener('close', onClose);
        dialog.showModal();
    } )}

    // Objective buttons (simple number picker, no ordering constraints)
    for (let btn of document.querySelectorAll('button.objective-input')) {
      btn.addEventListener('click', function () {
        if (btn.textContent) return;
        var dialog = document.getElementById('number-choice');
        dialog.returnValue = '';
        for (let numberBtn of dialog.querySelectorAll('.number-choice-btn')) {
          numberBtn.textContent = numberBtn.value;
          numberBtn.classList.remove('opacity-10', 'cursor-not-allowed', 'pointer-events-none');
        }
        var onClose = function () {
          dialog.removeEventListener('close', onClose);
          if (dialog.returnValue) {
            btn.textContent = dialog.returnValue;
            btn.setAttribute('value', dialog.returnValue);
            var moves = getMoves();
            moves.push({ key: btn.getAttribute('name'), value: dialog.returnValue });
            saveMoves(moves);
          }
          dialog.returnValue = '';
        };
        dialog.addEventListener('close', onClose);
        dialog.showModal();
      });
    }

    // Load
    replayMoves(getMoves());
    var savedCtrScore = localStorage.getItem('ctr-score');
    if (savedCtrScore) {
      var radio = document.querySelector('[name="ctr-score"][value="' + savedCtrScore + '"]');
      if (radio) radio.checked = true;
    }

    // Request fullscreen on first touch to hide browser chrome
    // document.addEventListener('click', function goFS() {
    //   document.removeEventListener('click', goFS);
    //   var el = document.documentElement;
    //   if (el.requestFullscreen) el.requestFullscreen().catch(function(){});
    //   else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    // }, { once: true });

    function * pairs(iterable) {
      let prev = null, first = true;
      for (let item of iterable) {
        if (!first) yield [prev, item];
        prev = item;
        first = false;
      }
    }
  </script>
</body>
</html>
